<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facility ID Validation Test Suite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #667eea;
            text-align: center;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-case {
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        .test-case.pass {
            border-left-color: #10b981;
            background: #d1fae5;
        }
        .test-case.fail {
            border-left-color: #ef4444;
            background: #fee2e2;
        }
        .test-label {
            font-weight: bold;
            margin-right: 10px;
        }
        .test-result {
            float: right;
            font-weight: bold;
        }
        .summary {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
        }
        .summary.success {
            color: #10b981;
        }
        .summary.failure {
            color: #ef4444;
        }
        code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <h1>üß™ Facility ID Validation Test Suite</h1>
    <div id="results"></div>
    <div id="summary"></div>

    <!-- Load validation utility -->
    <script src="./js/validation.js"></script>
    
    <script>
        const resultsDiv = document.getElementById('results');
        const summaryDiv = document.getElementById('summary');
        let totalTests = 0;
        let passedTests = 0;

        function runTest(section, testName, testFn, expected = true) {
            totalTests++;
            const passed = testFn() === expected;
            if (passed) passedTests++;

            const testCase = document.createElement('div');
            testCase.className = `test-case ${passed ? 'pass' : 'fail'}`;
            testCase.innerHTML = `
                <span class="test-label">${testName}</span>
                <span class="test-result">${passed ? '‚úÖ PASS' : '‚ùå FAIL'}</span>
            `;
            section.appendChild(testCase);

            return passed;
        }

        function createSection(title) {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `<h2>${title}</h2>`;
            resultsDiv.appendChild(section);
            return section;
        }

        // Wait for ValidationUtils to load
        setTimeout(() => {
            if (!window.ValidationUtils) {
                alert('ERROR: ValidationUtils not loaded! Make sure js/validation.js exists.');
                return;
            }

            const { isValidUUID, isValidFacilityId, hasValidId, filterValidEntities, getInvalidIdErrorMessage } = window.ValidationUtils;

            // Test 1: UUID Format Validation
            const section1 = createSection('1Ô∏è‚É£ UUID Format Validation');
            runTest(section1, 'Valid UUID (lowercase)', () => isValidUUID('550e8400-e29b-41d4-a716-446655440000'));
            runTest(section1, 'Valid UUID (uppercase)', () => isValidUUID('550E8400-E29B-41D4-A716-446655440000'));
            runTest(section1, 'Valid UUID (mixed case)', () => isValidUUID('550e8400-E29B-41d4-A716-446655440000'));
            runTest(section1, 'Invalid: not a UUID', () => isValidUUID('123456'), false);
            runTest(section1, 'Invalid: malformed UUID', () => isValidUUID('550e8400-e29b-41d4-a716'), false);
            runTest(section1, 'Invalid: null', () => isValidUUID(null), false);
            runTest(section1, 'Invalid: undefined', () => isValidUUID(undefined), false);
            runTest(section1, 'Invalid: empty string', () => isValidUUID(''), false);

            // Test 2: Facility ID Validation
            const section2 = createSection('2Ô∏è‚É£ Facility ID Validation');
            runTest(section2, 'Valid facility ID', () => isValidFacilityId('550e8400-e29b-41d4-a716-446655440000'));
            runTest(section2, 'Reject null', () => isValidFacilityId(null), false);
            runTest(section2, 'Reject undefined', () => isValidFacilityId(undefined), false);
            runTest(section2, 'Reject string "null"', () => isValidFacilityId('null'), false);
            runTest(section2, 'Reject string "undefined"', () => isValidFacilityId('undefined'), false);
            runTest(section2, 'Reject empty string', () => isValidFacilityId(''), false);
            runTest(section2, 'Reject whitespace', () => isValidFacilityId('   '), false);
            runTest(section2, 'Reject invalid UUID', () => isValidFacilityId('not-a-uuid'), false);

            // Test 3: Entity Validation
            const section3 = createSection('3Ô∏è‚É£ Entity Validation');
            const validEntity = { id: '550e8400-e29b-41d4-a716-446655440000', name: 'Test' };
            const invalidEntity1 = { id: null, name: 'Test' };
            const invalidEntity2 = { id: 'invalid', name: 'Test' };
            const invalidEntity3 = { name: 'Test' };

            runTest(section3, 'Valid entity', () => hasValidId(validEntity));
            runTest(section3, 'Entity with null ID', () => hasValidId(invalidEntity1), false);
            runTest(section3, 'Entity with invalid ID', () => hasValidId(invalidEntity2), false);
            runTest(section3, 'Entity without ID field', () => hasValidId(invalidEntity3), false);
            runTest(section3, 'Null entity', () => hasValidId(null), false);

            // Test 4: Array Filtering
            const section4 = createSection('4Ô∏è‚É£ Array Filtering');
            const mixedEntities = [
                { id: '550e8400-e29b-41d4-a716-446655440000', name: 'Valid 1' },
                { id: null, name: 'Invalid 1' },
                { id: '650e8400-e29b-41d4-a716-446655440001', name: 'Valid 2' },
                { id: 'invalid', name: 'Invalid 2' },
                { name: 'Invalid 3' },
                { id: '750e8400-e29b-41d4-a716-446655440002', name: 'Valid 3' }
            ];

            const filtered = filterValidEntities(mixedEntities);
            runTest(section4, 'Filter returns array', () => Array.isArray(filtered));
            runTest(section4, 'Correct count (3 valid)', () => filtered.length === 3);
            runTest(section4, 'First entity is valid', () => filtered[0].name === 'Valid 1');
            runTest(section4, 'All filtered have valid IDs', () => filtered.every(e => hasValidId(e)));

            // Test 5: Error Messages
            const section5 = createSection('5Ô∏è‚É£ Error Messages');
            runTest(section5, 'Message for null ID contains "bulunamadƒ±"', () => {
                const msg = getInvalidIdErrorMessage('tesis', null);
                return msg.includes('bulunamadƒ±');
            });
            runTest(section5, 'Message for invalid format contains "Ge√ßersiz"', () => {
                const msg = getInvalidIdErrorMessage('tesis', 'invalid-id');
                return msg.includes('Ge√ßersiz');
            });
            runTest(section5, 'Message capitalizes entity type', () => {
                const msg = getInvalidIdErrorMessage('proje', null);
                return msg.startsWith('Proje');
            });
            runTest(section5, 'Message for empty string', () => {
                const msg = getInvalidIdErrorMessage('tesis', '   ');
                return msg.includes('bulunamadƒ±');
            });

            // Test 6: Edge Cases
            const section6 = createSection('6Ô∏è‚É£ Edge Cases');
            runTest(section6, 'UUID with spaces (should fail)', () => isValidUUID(' 550e8400-e29b-41d4-a716-446655440000 '), false);
            runTest(section6, 'Number type (should fail)', () => isValidUUID(12345), false);
            runTest(section6, 'Boolean type (should fail)', () => isValidUUID(true), false);
            runTest(section6, 'Object type (should fail)', () => isValidUUID({}), false);
            runTest(section6, 'Array type (should fail)', () => isValidUUID([]), false);

            // Display Summary
            const successRate = ((passedTests / totalTests) * 100).toFixed(1);
            const allPassed = passedTests === totalTests;
            
            summaryDiv.className = `summary ${allPassed ? 'success' : 'failure'}`;
            summaryDiv.innerHTML = `
                <div style="font-size: 48px; margin: 20px 0;">
                    ${allPassed ? 'üéâ' : '‚ö†Ô∏è'}
                </div>
                <div>
                    ${passedTests} / ${totalTests} tests passed (${successRate}%)
                </div>
                <div style="margin-top: 20px; font-size: 18px;">
                    ${allPassed ? 
                        '‚úÖ All validation tests passed! The fix is working correctly.' : 
                        '‚ùå Some tests failed. Please review the implementation.'}
                </div>
            `;

            console.log(`Test Results: ${passedTests}/${totalTests} passed (${successRate}%)`);
        }, 100);
    </script>
</body>
</html>
