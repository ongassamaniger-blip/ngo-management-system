// ÇOK DİLLİ DESTEK - i18n (Internationalization)

// Dil çevirileri
const translations = {
    tr: {
        // Genel
        'welcome': 'Hoş Geldiniz',
        'logout': 'Çıkış',
        'save': 'Kaydet',
        'cancel': 'İptal',
        'delete': 'Sil',
        'edit': 'Düzenle',
        'search': 'Ara...',
        'loading': 'Yükleniyor...',
        
        // Menü
        'dashboard': 'Dashboard',
        'finance': 'Finans',
        'facilities': 'Tesisler',
        'projects': 'Projeler',
        'sacrifice': 'Kurban',
        'personnel': 'Personel',
        'profile': 'Profil',
        'users': 'Kullanıcılar',
        
        // Dashboard
        'overview': 'Genel Bakış',
        'totalIncome': 'Toplam Gelir',
        'totalExpense': 'Toplam Gider',
        'balance': 'Bakiye',
        'activeFacilities': 'Aktif Tesisler',
        'recentTransactions': 'Son İşlemler',
        'thisMonth': 'Bu Ay',
        
        // Finans
        'newIncome': 'Yeni Gelir',
        'newExpense': 'Yeni Gider',
        'filters': 'Filtreler',
        'applyFilters': 'Filtrele',
        'clearFilters': 'Temizle',
        'exportExcel': 'Excel İndir',
        'exportPDF': 'PDF İndir',
        
        // Toast Mesajları
        'successSave': 'Başarıyla kaydedildi!',
        'errorOccurred': 'Bir hata oluştu!',
        'profileUpdated': 'Profil güncellendi!',
        'passwordChanged': 'Şifre değiştirildi!',
        
        // Formlar
        'title': 'Başlık',
        'amount': 'Tutar',
        'category': 'Kategori',
        'date': 'Tarih',
        'description': 'Açıklama',
        'status': 'Durum'
    },
    
    en: {
        // General
        'welcome': 'Welcome',
        'logout': 'Logout',
        'save': 'Save',
        'cancel': 'Cancel',
        'delete': 'Delete',
        'edit': 'Edit',
        'search': 'Search...',
        'loading': 'Loading...',
        
        // Menu
        'dashboard': 'Dashboard',
        'finance': 'Finance',
        'facilities': 'Facilities',
        'projects': 'Projects',
        'sacrifice': 'Sacrifice',
        'personnel': 'Personnel',
        'profile': 'Profile',
        'users': 'Users',
        
        // Dashboard
        'overview': 'Overview',
        'totalIncome': 'Total Income',
        'totalExpense': 'Total Expense',
        'balance': 'Balance',
        'activeFacilities': 'Active Facilities',
        'recentTransactions': 'Recent Transactions',
        'thisMonth': 'This Month',
        
        // Finance
        'newIncome': 'New Income',
        'newExpense': 'New Expense',
        'filters': 'Filters',
        'applyFilters': 'Apply',
        'clearFilters': 'Clear',
        'exportExcel': 'Export Excel',
        'exportPDF': 'Export PDF',
        
        // Toast Messages
        'successSave': 'Saved successfully!',
        'errorOccurred': 'An error occurred!',
        'profileUpdated': 'Profile updated!',
        'passwordChanged': 'Password changed!',
        
        // Forms
        'title': 'Title',
        'amount': 'Amount',
        'category': 'Category',
        'date': 'Date',
        'description': 'Description',
        'status': 'Status'
    },
    
    ar: {
        // عام
        'welcome': 'مرحبا',
        'logout': 'تسجيل خروج',
        'save': 'حفظ',
        'cancel': 'إلغاء',
        'delete': 'حذف',
        'edit': 'تعديل',
        'search': 'بحث...',
        'loading': 'جاري التحميل...',
        
        // القائمة
        'dashboard': 'لوحة القيادة',
        'finance': 'المالية',
        'facilities': 'المنشآت',
        'projects': 'المشاريع',
        'sacrifice': 'الأضاحي',
        'personnel': 'الموظفين',
        'profile': 'الملف الشخصي',
        'users': 'المستخدمين',
        
        // لوحة القيادة
        'overview': 'نظرة عامة',
        'totalIncome': 'إجمالي الدخل',
        'totalExpense': 'إجمالي المصروفات',
        'balance': 'الرصيد',
        'activeFacilities': 'المنشآت النشطة',
        'recentTransactions': 'المعاملات الأخيرة',
        'thisMonth': 'هذا الشهر',
        
        // المالية
        'newIncome': 'دخل جديد',
        'newExpense': 'مصروف جديد',
        'filters': 'الفلاتر',
        'applyFilters': 'تطبيق',
        'clearFilters': 'مسح',
        'exportExcel': 'تصدير Excel',
        'exportPDF': 'تصدير PDF',
        
        // رسائل
        'successSave': 'تم الحفظ بنجاح!',
        'errorOccurred': 'حدث خطأ!',
        'profileUpdated': 'تم تحديث الملف الشخصي!',
        'passwordChanged': 'تم تغيير كلمة المرور!',
        
        // النماذج
        'title': 'العنوان',
        'amount': 'المبلغ',
        'category': 'الفئة',
        'date': 'التاريخ',
        'description': 'الوصف',
        'status': 'الحالة'
    },
    
    fr: {
        // Général
        'welcome': 'Bienvenue',
        'logout': 'Déconnexion',
        'save': 'Enregistrer',
        'cancel': 'Annuler',
        'delete': 'Supprimer',
        'edit': 'Modifier',
        'search': 'Rechercher...',
        'loading': 'Chargement...',
        
        // Menu
        'dashboard': 'Tableau de bord',
        'finance': 'Finance',
        'facilities': 'Installations',
        'projects': 'Projets',
        'sacrifice': 'Sacrifice',
        'personnel': 'Personnel',
        'profile': 'Profil',
        'users': 'Utilisateurs',
        
        // Tableau de bord
        'overview': 'Vue d\'ensemble',
        'totalIncome': 'Revenu total',
        'totalExpense': 'Dépense totale',
        'balance': 'Solde',
        'activeFacilities': 'Installations actives',
        'recentTransactions': 'Transactions récentes',
        'thisMonth': 'Ce mois',
        
        // Finance
        'newIncome': 'Nouveau revenu',
        'newExpense': 'Nouvelle dépense',
        'filters': 'Filtres',
        'applyFilters': 'Appliquer',
        'clearFilters': 'Effacer',
        'exportExcel': 'Exporter Excel',
        'exportPDF': 'Exporter PDF',
        
        // Messages
        'successSave': 'Enregistré avec succès!',
        'errorOccurred': 'Une erreur s\'est produite!',
        'profileUpdated': 'Profil mis à jour!',
        'passwordChanged': 'Mot de passe changé!',
        
        // Formulaires
        'title': 'Titre',
        'amount': 'Montant',
        'category': 'Catégorie',
        'date': 'Date',
        'description': 'Description',
        'status': 'Statut'
    }
};

// Aktif dil
let currentLanguage = localStorage.getItem('language') || 'tr';

// Dil başlat
function initLanguage() {
    const savedLang = localStorage.getItem('language') || 'tr';
    setLanguage(savedLang);
}

// Dil değiştir
function setLanguage(lang) {
    if (!translations[lang]) {
        console.error('Dil bulunamadı:', lang);
        return;
    }
    
    currentLanguage = lang;
    localStorage.setItem('language', lang);
    
    // HTML lang attribute
    document.documentElement.lang = lang;
    
    // RTL için (Arapça)
    if (lang === 'ar') {
        document.documentElement.dir = 'rtl';
    } else {
        document.documentElement.dir = 'ltr';
    }
    
    // Tüm çevirileri uygula
    translatePage();
    
    // Dil seçici butonunu güncelle
    updateLanguageButton();
}

// Sayfayı çevir
function translatePage() {
    // data-i18n attribute'u olan tüm elementleri bul
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = t(key);
        
        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.placeholder = translation;
        } else {
            element.textContent = translation;
        }
    });
}

// Çeviri al
function t(key) {
    return translations[currentLanguage][key] || key;
}

// Dil seçici butonunu güncelle
function updateLanguageButton() {
    const btn = document.getElementById('languageToggle');
    if (!btn) return;
    
    const flags = {
        'tr': '🇹🇷',
        'en': '🇬🇧',
        'ar': '🇸🇦',
        'fr': '🇫🇷'
    };
    
    btn.innerHTML = `<span class="text-xl">${flags[currentLanguage]}</span>`;
}

// Dil değiştirme menüsünü göster
function showLanguageMenu() {
    const languages = [
        { code: 'tr', name: 'Türkçe', flag: '🇹🇷' },
        { code: 'en', name: 'English', flag: '🇬🇧' },
        { code: 'ar', name: 'العربية', flag: '🇸🇦' },
        { code: 'fr', name: 'Français', flag: '🇫🇷' }
    ];
    
    const menuHtml = `
        <div id="languageMenu" class="absolute top-12 right-0 bg-white rounded-lg shadow-xl p-2 z-50 min-w-[150px]">
            ${languages.map(lang => `
                <button onclick="selectLanguage('${lang.code}')" class="w-full text-left px-4 py-2 hover:bg-purple-50 rounded flex items-center space-x-2 ${currentLanguage === lang.code ? 'bg-purple-100' : ''}">
                    <span>${lang.flag}</span>
                    <span class="text-sm">${lang.name}</span>
                </button>
            `).join('')}
        </div>
    `;
    
    // Önceki menüyü kaldır
    const oldMenu = document.getElementById('languageMenu');
    if (oldMenu) oldMenu.remove();
    
    // Yeni menü ekle
    const container = document.getElementById('languageToggle').parentElement;
    container.style.position = 'relative';
    container.insertAdjacentHTML('beforeend', menuHtml);
    
    // Dışarı tıklandığında kapat
    setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
            if (!e.target.closest('#languageToggle') && !e.target.closest('#languageMenu')) {
                const menu = document.getElementById('languageMenu');
                if (menu) menu.remove();
                document.removeEventListener('click', closeMenu);
            }
        });
    }, 100);
}

// Dil seç
window.selectLanguage = function(lang) {
    setLanguage(lang);
    const menu = document.getElementById('languageMenu');
    if (menu) menu.remove();
    
    if (window.ToastManager) {
        const langNames = {
            'tr': 'Türkçe',
            'en': 'English',
            'ar': 'العربية',
            'fr': 'Français'
        };
        ToastManager.success(`${langNames[lang]} seçildi`);
    }
};

// Global export
window.i18n = {
    initLanguage,
    setLanguage,
    t,
    showLanguageMenu,
    getCurrentLanguage: () => currentLanguage
};